<font color=red> volatile 关键字 </font>

[C语言中volatile关键字的作用](https://blog.csdn.net/tigerjibo/article/details/7427366)
[参考二](https://blog.csdn.net/vay0721/article/details/79035854)

[参考三](https://www.cnblogs.com/OpenCoder/p/7723825.html)

##### 定义
volatile关键字是一种类型修饰符，用它声明的类型变量表示可以被某些编译器未知的因素更改，比如：操作系统、硬件或者其它线程等。遇到这个关键字声明的变量，编译器对访问该变量的代码就不再进行优化，从而可以提供对特殊地址的稳定访问

##### 作用
- 用来修饰被不同线程访问和修改的变量
- 作为指令关键字，确保本条指令不会因编译器的优化而省略，且要求每次直接读值
- 防止编译器对代码进行优化
- 用于硬件地址
- 在其它程序或者同时运行的线程中共享数据





==⒈编译器的优化==

1. 在本次线程内，当读取一个变量时，为提高存取速度，编译器优化时有时会先把变量读取到一个寄存器中；以后再取变量值时，就直接从寄存器中取值；

2. 当变量值在本线程里改变时，会同时把变量的新值copy到该寄存器中，以便保持一致

3. 当变量在因别的线程等而改变了值，该寄存器的值不会相应改变，从而造成应用程序读取的值和实际的变量值不一致

4. 当该寄存器在因别的线程等而改变了值，原变量的值不会改变，从而造成应用程序读取的值和实际的变量值不一致


==⒉ 在什么情况下会出现==

1）并行设备的硬件寄存器

2）一个中断服务子程序中会访问到的非自动变量（Non-automatic variables)

3）多线程应用中被几个任务共享的变量



一般说来，volatile用在如下的几个地方：

1、中断服务程序中修改的供其它程序检测的变量需要加volatile；

2、多任务环境下各任务间共享的标志应该加volatile；

3、存储器映射的硬件寄存器通常也要加volatile说明，因为每次对它的读写都可能有不同意义；

另外，以上这几种情况经常还要同时考虑数据的完整性（相互关联的几个标志读了一半被打断了重写），在1中可以通过关中断来实现，2 中可以禁止任务调度，3中则只能依靠硬件的良好设计了。


- volatile处理结果：直接存取原始内存地址
- 频繁地使用volatile很可能会增加代码尺寸和降低性能,因此要合理的使用volatile




