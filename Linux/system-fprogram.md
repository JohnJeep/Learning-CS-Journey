<!--
 * @Author: JohnJeep
 * @Date: 2020-05-23 23:12:17
 * @LastEditTime: 2020-06-04 22:28:47
 * @LastEditors: Please set LastEditors
 * @Description: 系统函数的使用
--> 
<!-- TOC -->

- [1. System program](#1-system-program)
  - [1.1. 概念](#11-概念)
  - [1.2. 函数](#12-函数)
  - [1.3. 环境变量](#13-环境变量)
  - [1.4. fork函数](#14-fork函数)
  - [exec函数家族](#exec函数家族)

<!-- /TOC -->

# 1. System program
## 1.1. 概念
- 文件函数包括三部分内容
  - `file descriptor`  文件描述符
  - `file pointer(fp)` 文件指针
  - `file buffer`     文件数据缓冲区 
- 全部变量 `errno` 在Linux中存放位置 `/usr/include`
- 可以使用 `perror()` 打印错误的信息
- 文件的实际权限 = 用户给定的权限和本地的掩码取反做位与（&）操作


## 1.2. 函数
- `open()` 函数
  - 创建：`O_CREAT` 或采用 `截断为0的方式创建 O_TRUNC`
  - 读写：`O_RDWR`
  - 只读：`O_RDONLY`
  - 只写：`O_WRONLY`
  - 文件是否存在：`O_EXCL`
- `read()/write()` 函数
  - `-1` 读/写文件失败
  - `0`  文件读完了或文件写成完了
  - `>0` 读/写文件的字节数
- `lseek()` 函数 
  - 获取文件的长度
  - 移动文件指针
  - 文件拓展（只能向文件的中间或尾部扩展，不能向前端扩展）
- `stat()` 查看文件的所有状态信息。进行追踪或穿透，显示追踪到的文件或软连接指定的文件信息。
- `lstat()` 查看文件的状态信息。不进行追踪或穿透，直接显示当前文件或软连接的信息。
- `access()` 测试指定文件是否拥有某种权限。 
- `chmod()` 改变文件的权限
- `truncate()` 将指定文件的大小由指定参数 `length` 长度确定，
  - `length` 长度大于当前文件，文件将被拓展
  - `length` 长度小于当前文件，文件截取，截取值为 `length` 值
- `readlink()` 读一个软链接的值
- `unlink()` 
  - 删除一个硬链接数
  - 可以读取临时文件的内容。先创建文件，向文件写，然后读文件中写的内容并将读出的数据写到另外的一个文件中。


- `opendir()` 打开一个目录
- `readdir()` 读一个目录
- `closedir()` 关闭一个目录


- `dup` 或 `dup2` 复制文件描述符
- `fcntl` 改变已经打开文件的属性，即获取或设置文件的状态标记。
  - `F_GETFL` 获取文件状态参数
  - `F_SETFL` 设置文件状态参数
   

## 1.3. 环境变量
- 常见的环境变量
  - `PATH ` 指定可执行文件搜索路径
  - `SHELL` 指定当前所使用的命令解析器
  - `TERM ` 当前终端类型
  - `LANG ` 指定语言环境
  - `HOME ` 用户主目录


- 常见的环境变量函数 
  - `getenv()` 获取环境变量值
  - `setenv()` 设置环境变量值
	  - 3个参数
			- `1`  覆盖原值
			- `0`  不覆盖
			- `-1` 出错
  - `unsetenv()` 删除环境变量



## 1.4. fork函数
- 创建一个子进程。一个进程调用 `fork()` 函数，变为两个进程，各自的进程都有一个返回值。父进程返回值为子进程的 `PID`（返回值大于0），子进程的返回值为 `0`，进程创建成功。
- 父子进程之间遵循原则：`读时共享写时复制`。例如：一个全局变量，子进程只读时，则父子进程共享变量；若子进程对全局变量写操作时，则不共享全局变量。
- 父子进程共享
  - 共享文件描述符。
  - 共享 `mmap` 建立的映射区。
- 执行 `fork` 操作之后，是父进程先执行还是子进程先执行，是不确定的，取决于系统内的调度算法。
- 子进程与父进程异同点
  - 相同
    - 全局变量 
    - .data
    - .text
    - 栈、堆
    - 环境变量
    - 用户 ID
    - 宿主目录
    - 进程工作目录
    - 信号处理方式
  - 不同
    - 进程控制块(当前进程的父进程ID)
    - PID
    - fork返回值
    - 定时器
    - 未决信号集
    - 进程运行时间 


- 可能用到的函数
  - `getpid()`  获取子进程PID号
  - `getppid()` 获取父进程PID号
  - `getuid()`  获取当前进程实际用户ID号
  - `geteuid()` 获取当前进程有效用户ID号
  - `getgid()`  获取当前进程实际用户组ID号
  - `getegid()` 获取当前进程有效用户组ID号


## exec函数家族
执行exec()家族的函数后，将当前进程的内存空间数据替换为要执行函数的内存空间数据。

- `execlp` 加载一个进程，通过环境变量加载。
- `execl` 加载一个进程，通过路径 + 程序名称来加载。
- `execle`
- `execv`
- `execvp`
- `execvpe`






